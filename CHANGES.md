<!--
File Chain (see DEVELOPER.md):
Doc Version: v1.2.8
Date Modified: 2026-02-20

- Called by: Users checking release notes, package managers, documentation generators
- Reads from: Developer commits, PR descriptions, completed TODO items
- Writes to: None (documentation only, but informs release notes and versioning)
- Calls into: None (changelog-only)

Purpose: Changelog documenting all user-facing changes, features, and bug fixes.
         Follows conventional commit style (feat, fix, docs, refactor).
         Used for release notes and version history.

Blast Radius: None (documentation only, but critical for communicating changes to users)
-->

# Changes

This file lists changes. Format for Unreleased entries (files changed + rev): see [DEVELOPER.md Feature closeout checklist](DEVELOPER.md#feature-closeout-checklist).

- Unreleased
  - docs(pki): add PKI.md — single reference for TopoGen PKI (flags, CA-ROOT, clients, EEM applets, known issues, auto-deploy certs, troubleshooting); add PKI.md to README documentation map
    - Files: PKI.md (new, rev v1.0.0), README.md (rev v1.4.7 → v1.4.8), CHANGES.md (rev v1.2.7 → v1.2.8)
  - feat(quiet): add `-q` / `--quiet` flag to suppress non-essential output
    - When set, log level is forced to ERROR so only errors and final result are shown; useful for scripts and CI/CD
    - Files: src/topogen/main.py (rev v1.1.3 → v1.1.4), CHANGES.md (rev v1.2.6 → v1.2.7), README.md (rev v1.4.5 → v1.4.6), DEVELOPER.md (rev v1.7.3 → v1.7.4), TODO.md (rev v1.6.3 → v1.6.4)
  - fix(online): pass VIRL2_URL, VIRL2_USER, VIRL2_PASS explicitly into ClientLibrary
    - TopoGen now reads env vars and passes url/username/password to virl2_client.ClientLibrary(); fixes "no env provided" when vars are set in PowerShell/shell before running topogen
    - Files: src/topogen/render.py (rev v1.0.11 → v1.0.12), CHANGES.md (rev v1.2.5 → v1.2.6)
  - feat(archive): add `--archive` flag and archive config block to all IOS/IOS-XE templates (feat/archive branch)
    - CLI: `--archive` enables config archiving and rundiff alias on routers (opt-in)
    - Enables: `archive` with `log config`, `path flash:`, `maximum 5`, `write-memory`; `alias exec rundiff` when `--archive` set; block omitted otherwise
    - Templates: csr-dmvpn, csr-eigrp, csr-ospf, csr-pki-ca, iosv, iosv-dmvpn, iosv-eigrp, iosv-eigrp-stub, iosv-eigrp-nonflat, iol-xe; lxc (FRR) not applicable. Offline flat args_bits include `--pki` and `--archive` when set
    - Files: src/topogen/main.py (rev v1.1.2 → v1.1.3), src/topogen/render.py (rev v1.0.11 → v1.0.12), src/topogen/templates/*.jinja2 (10 files), TODO.md (rev v1.6.2 → v1.6.3), README.md (rev v1.4.4 → v1.4.5), DEVELOPER.md (rev v1.7.2 → v1.7.3), CHANGES.md (rev v1.2.5 → v1.2.6)
  - fix(dmvpn): OOB switch overflow in `offline_dmvpn_flat_pair_yaml` — `num_oob_sw` was set to `num_access` (NBMA switch count, based on odd routers only), but OOB connects ALL routers; with large labs (e.g. 200 nodes, group=20) each OOB access switch got 40 routers + 1 uplink = 41 ports, exceeding the CML `unmanaged_switch` 32-port cap; fix: `num_oob_sw = ceil(total_routers / oob_group)` so OOB switches are sized by total router count
    - Files: src/topogen/render.py (rev v1.0.10 → v1.0.11), CHANGES.md (rev v1.2.4 → v1.2.5)
  - fix(dmvpn): EEM CLIENT-PKI-SET-CLOCK and CLIENT-PKI-AUTHENTICATE timers increased from 90 s/95 s to 300 s/305 s to give CA-ROOT sufficient time to boot and start its PKI server before spoke enrollment attempts; if CA-ROOT is not reachable when the timer fires, manual `authc` is the workaround
    - Files: src/topogen/render.py (rev v1.0.9 → v1.0.10), CHANGES.md (rev v1.2.3 → v1.2.4)
  - fix(dmvpn): EEM applets now injected LAST in startup config (before final `end`), after all interface/routing/crypto sections — previously EEM applets were placed before the IKEv2/interface/routing sections, and each applet's closing `end` exits IOS-XE global config mode, causing everything after the first EEM `end` to be silently ignored at boot (interfaces never came up, no IPs assigned, no EIGRP/DMVPN)
    - Root cause: `_inject_pki_client_trustpoint` built one combined block (trustpoint definition + EEM applets) and injected it before `crypto ikev2 proposal`; EEM applet `end` closes the applet submode and exits global config, so all subsequent config (IKEv2, interfaces, routing) was lost
    - Fix: split into two injection points — trustpoint definition still injected before `crypto ikev2 proposal` (forward-reference fix from v1.0.8), EEM applets now injected in a separate pass before the final `end`
    - Files: src/topogen/render.py (rev v1.0.8 → v1.0.9), CHANGES.md (rev v1.2.2 → v1.2.3)
  - fix(dmvpn): IKEv2 PKI trustpoint injection order — `crypto pki trustpoint CA-ROOT-SELF` now injected BEFORE `crypto ikev2 proposal` so IOS-XE does not reject the forward reference to the undefined trustpoint at boot; fixes `pki trustpoint CA-ROOT-SELF` being silently dropped from the IKEv2 profile in running-config on all routers
    - Root cause: `_inject_pki_client_trustpoint` was injecting before `end` (end of config), placing the trustpoint definition after the IKEv2 profile that referenced it; IOS-XE processes startup config sequentially and silently drops `pki trustpoint` references to trustpoints not yet defined
    - Fix: injection point changed to before `crypto ikev2 proposal` when present, falling back to before `end`
    - Files: src/topogen/render.py (rev v1.0.7 → v1.0.8), CHANGES.md (rev v1.2.1 → v1.2.2)
  - feat(dmvpn): add DMVPN IKEv2 PKI (certificate-based auth)
    - `--dmvpn-security ikev2-pki`: IKEv2 with RSA-sig auth using trustpoint CA-ROOT-SELF (requires `--pki`)
    - CLI: add `ikev2-pki` to `--dmvpn-security` choices; validate `ikev2-pki` requires `--pki`
    - Templates: iosv-dmvpn and csr-dmvpn emit IKEv2 profile with `authentication local rsa-sig`, `authentication remote rsa-sig`, `pki trustpoint CA-ROOT-SELF`; no keyring
    - Online DMVPN: inject PKI client trustpoint on non-CA routers when `--pki` (flat and flat-pair)
    - Offline DMVPN: args_bits include `--pki` when pki_enabled for lab description
    - Files: src/topogen/main.py, src/topogen/render.py, src/topogen/templates/csr-dmvpn.jinja2 (rev v1.1.0), src/topogen/templates/iosv-dmvpn.jinja2 (rev v1.1.0), README.md (rev v1.4.0), CHANGES.md (rev v1.1.8), TODO.md (rev v1.5.3), DEVELOPER.md (rev v1.4.3)
  - feat(import): add offline-to-CML import workflow
    - `--import-yaml FILE`: path to existing offline YAML (skip generation); use with `--import`
    - `--import`: import the generated or specified YAML into CML via virl2_client (requires `--offline-yaml` or `--import-yaml`)
    - prints file size (KB) before import and lab URL after import (clickable)
    - `--start` works after import (start runs in background so CLI returns immediately)
    - workflows: generate then import (`--offline-yaml out/lab.yaml --import`), or import existing (`--import-yaml out/lab.yaml --import`), optionally `--start`
    - Files: src/topogen/main.py (rev v1.0.0), src/topogen/render.py (rev v1.0.4), src/topogen/__main__.py (rev v1.0.0), CHANGES.md (rev v1.1.7), README.md (rev v1.3.4), TODO.md (rev v1.5.2), DEVELOPER.md (rev v1.4.2)
  - feat(cli): add `--up FILE` shorthand for `--import-yaml FILE --import --start`
  - feat(cli): add `--print-up-cmd` to print "When you're ready: topogen --up <file>" after offline generation
  - fix(ntp): NTP server uses VRF only when --mgmt is enabled (inband `ntp server IP` without OOB)
  - feat(cli): add `src/topogen/__main__.py` so `python -m topogen` works
  - fix(gooey): ignore empty `--up` from GUI so "Import requires ..." error does not occur when field left blank
  - feat(online): make `--start` non-blocking (online and import paths)
    - start runs in a background thread; CLI prints "Starting lab... (running in background; check CML UI for status)" and returns
    - lab continues starting on the server; user can watch CML UI
  - feat(mgmt): add OOB management network support for flat, flat-pair, and dmvpn modes
    - enable with `--mgmt`
    - creates `SWoob0` unmanaged switch (with `hide_links: true`) and connects all router mgmt interfaces
    - mgmt interface uses DHCP by default (slot 5: IOSv Gi0/5, CSR Gi5)
    - default VRF `Mgmt-vrf`; use `--mgmt-vrf global` for global routing table
    - optional gateway route with `--mgmt-gw IP`
    - configurable slot with `--mgmt-slot N`
    - dmvpn modes (flat and flat-pair underlay) now support `--mgmt` for OOB management
  - feat(ntp): add NTP server configuration
    - enable with `--ntp IP`
    - optional VRF with `--ntp-vrf NAME` (inherits `--mgmt-vrf` if not specified)
  - feat(mgmt): add external-connector bridge support for OOB management network
    - enable with `--mgmt-bridge` (requires `--mgmt`)
    - creates `ext-conn-mgmt` external_connector node with "System Bridge" mode
    - bridges SWoob0 port 0 to external/physical network for bidirectional connectivity
    - enables routers to reach external resources (internet, NTP servers, DHCP, etc.)
    - supported in all offline modes: flat, flat-pair, dmvpn, dmvpn-flat-pair
  - feat(mgmt): add `--mgmt-bridge` support for online NX and simple modes
    - OOB management infrastructure created before router creation to avoid interface conflicts
    - management interfaces connected to SWoob0 at creation time
    - CSR1000v uses slot-1 adjustment (slot 5 -> GigabitEthernet4)
  - feat(online): print lab URL after creation for easy browser access
    - format: `Lab URL: https://<controller>/lab/<lab-id>`
    - uses VIRL2_URL environment variable
  - feat(online): add `--start` flag to auto-start labs after creation
    - starts all nodes automatically when lab creation completes
    - useful for immediate testing and validation
  - feat(online): include all CLI args in lab description for repeatability
    - lab descriptions now include --mgmt, --mgmt-vrf, --mgmt-bridge, --ntp, --ntp-vrf, --start
    - enables exact command reconstruction from CML2 UI
  - feat(remark): add `--remark` flag to add custom notes to lab descriptions
  - feat(flat): add new mode "flat-pair" (odd-even pairing). Odd: Gi0/0 -> access switch and Gi0/1 -> even's Gi0/0. Even: no leaf link. Last odd without partner leaves Gi0/1 unused.
  - feat(vrf): add optional VRF support for flat-pair pair links (odd router Gi0/1)
    - enable with `--vrf`
    - set VRF name with `--pair-vrf NAME`
    - lab descriptions (online and offline YAML) include VRF flags when enabled
  - feat(dmvpn): add `--eigrp-stub` to enable `eigrp stub connected summary` on DMVPN flat-pair even routers (pair partners)
  - feat(iosxe): add CSR1000v (IOS-XE) EIGRP template `csr-eigrp`
    - uses `vrf definition TENANT` with `rd 1:1` and `vrf forwarding TENANT`
    - offline YAML uses CSR interface labels (GigabitEthernet1/2/...) when `--device-template csr1000v` is used
  - feat(dmvpn): add DMVPN mode (hub + N spokes) with offline YAML support
    - nodes argument is the number of spokes (R1 is hub; R2.. are spokes)
    - supports `--dmvpn-phase`, `--dmvpn-routing`, `--dmvpn-security`, `--dmvpn-nbma-cidr`, `--dmvpn-tunnel-cidr`
    - templates: `iosv-dmvpn` and `csr-dmvpn`
  - feat(dmvpn): support multi-hub DMVPN
    - select hub router numbers with `--dmvpn-hubs` (e.g., `1,21,41`)
    - when `--dmvpn-hubs` is set, `nodes` is interpreted as total routers (R1..R<nodes>)
    - spokes configure NHRP mappings and NHS entries for all hubs
  - feat(dmvpn): add DMVPN tunnel key option `--dmvpn-tunnel-key` (default: 10)
  - feat(dmvpn): add DMVPN IKEv2 PSK security profile
    - enable with `--dmvpn-security ikev2-psk`
    - provide shared PSK with `--dmvpn-psk <key>`
  - feat(offline): fail if `--offline-yaml FILE` already exists (no-clobber by default)
    - overwrite explicitly with `--overwrite`
  - feat(progress): improve progress/completion visibility
    - DMVPN online supports `--progress` (opt-in)
    - DMVPN offline YAML supports `--progress` (opt-in)
    - DMVPN offline YAML emits a visible "written to <file>" completion message at default loglevel
  - feat(dmvpn): scale offline DMVPN NBMA segment using a flat-style unmanaged switch fabric (core + access switches)
    - uses `--flat-group-size` to control routers per access switch
    - offline YAML layout matches `flat` / `flat-pair` placement style
  - chore: reduce default `DMVPN-ping.tcl` sweep size to 10 for faster ad-hoc validation
  - feat(gui): add optional Gooey GUI (`topogen-gui`) and `topogen[gui]` extra
    - GUI-only: template dropdown and common device-template dropdown
    - GUI-only: clearer offline/online YAML file labels and file-save pickers
  - docs: offline YAML output is recommended to be written under the `out/` directory (see README examples)
  - fix(templates): set `line vty 0 4` `exec-timeout` to `0 0` (was `720 0`)
  - chore(ping): increase DMVPN-ping.tcl sweep max from 10 to 20 (reverts earlier reduction)
  - docs(__init__): add File Chain front matter, entry points, and public API exports section
    - Files: src/topogen/__init__.py (rev v1.1.0)
  - docs(todo): update PKI naming (RCA-ROOT → CA-ROOT, RCA-ICA → CA-POLICY), mark 4 tasks complete, add future ideas
    - Files: TODO.md (rev v1.4.0)
  - docs(readme): add concrete intent/metadata example showing embedded string format and grep command
    - Files: README.md (rev v1.3.1)
  - docs(todo): add --pki-scep future idea (replace dead --pki-enroll, CA name fix, router trustpoint)
    - Files: TODO.md (rev v1.4.1)
  - feat(pki): add single root CA router for DMVPN PKI
    - `--pki`: add CA-ROOT node to DMVPN labs (connects to SWnbma0 slot 0 and OOB switch if `--mgmt`)
    - `--pki-enroll scep|cli` CLI flags (main.py); CA IP = last usable in NBMA CIDR
    - csr-pki-ca.jinja2 template; CA-ROOT naming; CA-POLICY / CA-SIGN reserved for future
  - docs(templates): add File Chain front matter with Doc Version to csr-pki-ca.jinja2
    - Files: src/topogen/templates/csr-pki-ca.jinja2 (rev v1.0.0)
  - chore(templates): add `alias exec rundiff` to all router templates
    - `alias exec rundiff show archive config differences system:running-config` placed before `line vty 0 4`
    - Files: src/topogen/templates/csr-pki-ca.jinja2 (rev v1.0.1)
    - Files: src/topogen/templates/csr-dmvpn.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/csr-eigrp.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/csr-ospf.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/iol-xe.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/iosv-dmvpn.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/iosv-eigrp.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/iosv-eigrp-nonflat.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/iosv-eigrp-stub.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/iosv.jinja2 (rev v1.0.0)
  - feat(pki): harden CA-ROOT template with validated running config changes
    - RSA key: add `exportable` flag (`crypto key generate rsa modulus 2048 label CA-ROOT.server exportable`)
    - PKI server: reorder block to match IOS-XE canonical order
    - PKI server: `lifetime certificate` and `lifetime ca-certificate` 3650/1095 → 7300 days
    - PKI server: `no shut` → `no shutdown`
    - HTTP: `ip http secure-server` → `no ip http secure-server` (SCEP uses plain HTTP only)
    - NTP: `ntp master 5` → `ntp master 6` (matches validated lab config)
    - Interface: Gi1 always gets `description === SCEP Enrollment URL ===`
    - EEM: add `CA-ROOT-SET-CLOCK` applet (90s countdown, NTP check, clock force + ntp master fallback)
    - EEM: init `event manager environment TIME_DONE 0` in startup config
    - Files: src/topogen/templates/csr-pki-ca.jinja2 (rev v1.0.2)
  - docs(templates): add File Chain front matter (Doc Version v1.0.0) to 9 templates missing it
    - Files: src/topogen/templates/csr-dmvpn.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/csr-eigrp.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/csr-ospf.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/iol-xe.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/iosv-dmvpn.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/iosv-eigrp.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/iosv-eigrp-nonflat.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/iosv-eigrp-stub.jinja2 (rev v1.0.0)
    - Files: src/topogen/templates/iosv.jinja2 (rev v1.0.0)

- version 0.2.4
  - empty

- version 0.2.3
  - feat(flat): add flat mode for topology generation
  - deterministic addressing and EIGRP template updates
  - docs: add CONTRIBUTING.md and update README/examples
  - config: add config.sample.toml with sane defaults
  - templates/flags: add addressing flags and custom-template warning
  - feat: add offline YAML export for CML 2.9 (schema flag)
  - chore: ignore generated offline YAML and untrack sample YAML
  - chore(gitignore): ignore NX lab YAML exports ([Nn][Xx]-*.yaml)
  - feat(template): add iosv-eigrp-stub template (enable EIGRP stub connected summary)
  - docs(readme): note non-flat EIGRP default-route limitation (user must originate default)
  - feat(template): add iosv-eigrp-nonflat for simple/NX (EIGRP 100 on 10.0.0.0/8 and 172.16.0.0/12; passive Lo0)
  - docs(readme): add non-flat EIGRP examples and note that large online builds may not show UI updates until ~25%
  - docs(readme): add flat mode examples

- version 0.2.1 (identical to 0.2.0, but make gh actions happy)
- version 0.2.0
  - properly configure name server / domain name
  - properly inject default route
  - fix indentation for boot.sh script
  - adapted some typing
  - renamed iol.jinja2 to iol-xe.jnja.2
  - added special LXC FRR variant
  - constrain number of node CLI arg
  - fix weird bug when DNS host is selected as the central node
  - updated dependencies
- version 0.1.4
  - added an IOL template
  - removed requests and associated libraries
  - add support to generate IOL nodes
  - fixed "ignore" SSL errors cmd line flag
- version 0.1.3 and earlier were the initial release
