hostname {{ node.hostname }}
!
service timestamps debug datetime msec
service timestamps log datetime msec
no service password-encryption
no service config
enable password {{ config.password }}
ip classless
ip subnet-zero
ip domain lookup
ip name-server {{ config.nameserver }}
ip domain name {{ config.domainname }}
crypto key generate rsa modulus 2048
ip ssh version 2
ip ssh server algorithm authentication password
username {{ config.username }} privilege 15 secret {{ config.password }}
cdp run
!
{%- set ns = namespace(nbma=None, tun=None) %}
{%- for iface in node.interfaces %}
{%- if iface.description == "dmvpn nbma" %}
{%- set ns.nbma = iface.address %}
{%- endif %}
{%- if iface.description == "dmvpn tunnel" %}
{%- set ns.tun = iface.address %}
{%- endif %}
{%- endfor %}
!
interface GigabitEthernet1
 ip address {{ ns.nbma.ip }} {{ ns.nbma.netmask }}
 no shutdown
!
interface Loopback0
 ip address {{ node.loopback.ip }} {{ node.loopback.netmask }}
!
interface Tunnel0
 ip address {{ ns.tun.ip }} {{ ns.tun.netmask }}
 no ip redirects
 tunnel source GigabitEthernet1
 tunnel key {{ dmvpn_tunnel_key }}
 tunnel mode gre multipoint
 ip nhrp network-id 10
{%- if is_hub %}
 ip nhrp redirect
 no ip split-horizon eigrp 100
{%- else %}
{%- for hub in hub_info %}
 ip nhrp map {{ hub.hub_tunnel_ip }} {{ hub.hub_nbma_ip }}
 ip nhrp map multicast {{ hub.hub_nbma_ip }}
 ip nhrp nhs {{ hub.hub_tunnel_ip }}
{%- endfor %}
{%- endif %}
!
router eigrp 100
 network {{ ns.tun.ip }} 0.0.0.0
 network {{ node.loopback.ip }} 0.0.0.0
 passive-interface default
 passive-interface GigabitEthernet1
 no passive-interface Tunnel0
!
line vty 0 4
 transport input ssh telnet
 exec-timeout 720 0
 login local
line con 0
 password {{ config.password }}
 exec-timeout 0 0
!
end
